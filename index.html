<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no" />
  <title>Kado Ulang Tahun Special untuk Kamu 🎂</title>
  <meta name="theme-color" content="#ff6b9d" />
  <style>
    :root {
      --primary: #ff6b9d;
      --secondary: #4ecdc4;
      --accent: #45b7d1;
      --text-light: #ffffff;
      --text-dark: #2c3e50;
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      height: 100vh;
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      overflow: hidden;
      position: fixed;
      width: 100%;
    }

    body {
      background: linear-gradient(-45deg, #667eea, #764ba2, #f093fb, #f5576c, #4facfe, #00f2fe);
      background-size: 400% 400%;
      animation: gradientShift 12s ease-in-out infinite;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      25% { background-position: 100% 50%; }
      50% { background-position: 100% 100%; }
      75% { background-position: 0% 100%; }
      100% { background-position: 0% 50%; }
    }

    /* Particle System Background */
    #particles-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      pointer-events: none;
    }

    /* Main Container */
    .container {
      width: 100vw;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 10;
      padding: 20px;
    }

    /* Loading Screen */
    .loading-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      transition: all 1s ease-out;
    }

    .loading-screen.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .loading-spinner {
      width: 60px;
      height: 60px;
      border: 4px solid rgba(255,255,255,0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }

    /* Main Card */
    .card {
      width: min(420px, 90vw);
      background: var(--glass-bg);
      backdrop-filter: blur(30px);
      -webkit-backdrop-filter: blur(30px);
      border: 1px solid var(--glass-border);
      border-radius: 30px;
      padding: 40px 30px;
      text-align: center;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.3);
      transform: scale(0.8) rotateY(10deg);
      opacity: 0;
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      position: relative;
      overflow: hidden;
    }

    .card.show {
      transform: scale(1) rotateY(0deg);
      opacity: 1;
    }

    .card::before {
      content: '';
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: linear-gradient(45deg, var(--primary), var(--secondary), var(--accent));
      border-radius: 30px;
      z-index: -1;
      animation: rotateBorder 8s linear infinite;
    }

    @keyframes rotateBorder {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* 3D Floating Emoji */
    .big-emoji {
      font-size: 5rem;
      margin: 0 0 25px 0;
      display: block;
      animation: float3D 4s ease-in-out infinite;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
      cursor: pointer;
      transition: all 0.3s ease;
    }

    @keyframes float3D {
      0%, 100% { 
        transform: translateY(0px) rotateX(0deg) rotateY(0deg);
      }
      25% { 
        transform: translateY(-15px) rotateX(10deg) rotateY(5deg);
      }
      50% { 
        transform: translateY(-10px) rotateX(-5deg) rotateY(-10deg);
      }
      75% { 
        transform: translateY(-20px) rotateX(15deg) rotateY(8deg);
      }
    }

    .big-emoji:hover {
      transform: scale(1.1) rotateY(15deg);
      animation-play-state: paused;
    }

    /* Typography */
    h1 {
      font-size: 2rem;
      font-weight: 800;
      color: var(--text-light);
      margin: 0 0 10px 0;
      line-height: 1.2;
      text-shadow: 0 4px 20px rgba(0,0,0,0.5);
      background: linear-gradient(135deg, #fff, #e3f2fd);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      color: rgba(255,255,255,0.9);
      font-size: 1.1rem;
      margin: 0 0 30px 0;
      font-weight: 500;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
    }

    /* Advanced Button */
    .btn {
      background: linear-gradient(135deg, var(--primary) 0%, #ff8a80 100%);
      border: none;
      border-radius: 50px;
      padding: 20px 40px;
      font-size: 1.2rem;
      font-weight: 700;
      color: white;
      cursor: pointer;
      box-shadow: 0 15px 35px rgba(255, 107, 157, 0.4);
      transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
      outline: none;
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
      transition: left 0.7s;
    }

    .btn:hover {
      transform: translateY(-5px) scale(1.05);
      box-shadow: 0 20px 40px rgba(255, 107, 157, 0.6);
    }

    .btn:hover::before {
      left: 100%;
    }

    .btn:active {
      transform: translateY(-2px) scale(1.02);
    }

    /* Photo Gallery */
    .photo-gallery {
      display: none;
      margin: 30px 0;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease;
    }

    .photo-gallery.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .photo-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    .photo-item {
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      aspect-ratio: 1;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }

    .photo-item:hover {
      transform: scale(1.05) rotateZ(2deg);
      box-shadow: 0 15px 35px rgba(0,0,0,0.4);
    }

    .photo-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: all 0.3s ease;
    }

    .photo-item:hover img {
      transform: scale(1.1);
    }

    .photo-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(45deg, rgba(255,107,157,0.8), rgba(78,205,196,0.8));
      opacity: 0;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    .photo-item:hover .photo-overlay {
      opacity: 1;
    }

    /* Message Container */
    .message-container {
      display: none;
      margin: 25px 0;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease;
    }

    .message-container.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    .message {
      background: var(--glass-bg);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border: 1px solid var(--glass-border);
      border-radius: 20px;
      padding: 30px;
      text-align: left;
      line-height: 1.8;
      color: var(--text-light);
      font-size: 1.05rem;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      position: relative;
      overflow: hidden;
    }

    .message::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
      animation: shimmer 2s linear infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .message-text {
      font-weight: 500;
      text-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    /* Typewriter Effect */
    .typing-cursor {
      display: inline-block;
      background: var(--primary);
      width: 3px;
      height: 1.2em;
      margin-left: 3px;
      animation: blink 1s infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Interactive Actions */
    .actions {
      display: none;
      margin: 25px 0;
      opacity: 0;
      transform: translateY(30px);
      transition: all 0.6s ease;
    }

    .actions.show {
      display: flex;
      flex-direction: column;
      gap: 15px;
      opacity: 1;
      transform: translateY(0);
    }

    .action-chip {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      -webkit-backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      border-radius: 30px;
      padding: 15px 20px;
      color: var(--text-light);
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .action-chip:hover {
      transform: translateX(10px) scale(1.02);
      background: rgba(255,255,255,0.2);
      box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    }

    .action-chip::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.6s;
    }

    .action-chip:hover::before {
      left: 100%;
    }

    /* Signature */
    .signature {
      display: none;
      margin-top: 25px;
      color: rgba(255,255,255,0.8);
      font-size: 1rem;
      font-style: italic;
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }

    .signature.show {
      display: block;
      opacity: 1;
      transform: translateY(0);
    }

    /* Modal for Photo Preview */
    .photo-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 2000;
      backdrop-filter: blur(10px);
    }

    .photo-modal.show {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    .photo-modal img {
      max-width: 90%;
      max-height: 90%;
      border-radius: 15px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      transform: scale(0.8);
      transition: transform 0.3s ease;
    }

    .photo-modal.show img {
      transform: scale(1);
    }

    .photo-modal-close {
      position: absolute;
      top: 30px;
      right: 30px;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      background: rgba(255,255,255,0.2);
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      transition: all 0.3s ease;
    }

    .photo-modal-close:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }

    /* Confetti Canvas */
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1500;
    }

    /* Fireworks Canvas */
    #fireworks-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1400;
    }

    /* Music Controls */
    .music-controls {
      position: fixed;
      bottom: 30px;
      right: 30px;
      z-index: 100;
      display: flex;
      gap: 10px;
    }

    .music-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--glass-border);
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .music-btn:hover {
      transform: scale(1.1);
      background: rgba(255,255,255,0.2);
    }

    /* Mobile Responsive */
    @media (max-width: 450px) {
      .card {
        width: 95vw;
        padding: 30px 20px;
      }

      h1 { font-size: 1.7rem; }
      .big-emoji { font-size: 4rem; }
      .btn { padding: 16px 30px; font-size: 1rem; }
      .message { padding: 25px 20px; font-size: 1rem; }
      
      .photo-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }
      
      .music-controls {
        bottom: 20px;
        right: 20px;
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Special Effects */
    .sparkle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: white;
      border-radius: 50%;
      pointer-events: none;
      animation: sparkleAnim 1.5s ease-out forwards;
    }

    @keyframes sparkleAnim {
      0% {
        opacity: 0;
        transform: scale(0);
      }
      50% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0);
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-spinner"></div>
    <div class="loading-text">Menyiapkan kejutan spesial... 💕</div>
  </div>

  <!-- Particle Background -->
  <canvas id="particles-canvas"></canvas>

  <!-- Confetti Canvas -->
  <canvas id="confetti-canvas"></canvas>

  <!-- Fireworks Canvas -->
  <canvas id="fireworks-canvas"></canvas>

  <!-- Music Controls -->
  <div class="music-controls">
    <button class="music-btn" id="playMusicBtn" title="Putar Musik">🎵</button>
    <button class="music-btn" id="pauseMusicBtn" title="Pause Musik" style="display:none;">⏸️</button>
  </div>

  <!-- Main Container -->
  <div class="container">
    <div class="card" id="mainCard">
      <div class="big-emoji" id="mainEmoji">🎁</div>
      <h1>Selamat Ulang Tahun,<br><span id="targetName">Ayu Cantik</span>!</h1>
      <p class="subtitle" id="birthdayDate">16 Agustus 2025</p>
      <button class="btn" id="openGiftBtn">🎉 BUKA KADONYA 🎉</button>

      <!-- Photo Gallery -->
      <div class="photo-gallery" id="photoGallery">
        <h3 style="color: white; margin-bottom: 20px; font-size: 1.3rem;">🌟 Kenangan Indah Kita 🌟</h3>
        <div class="photo-grid">
          <!-- Foto akan diload dari folder images/ -->
          <div class="photo-item" data-photo="images/foto1.jpg">
            <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?w=300&h=300&fit=crop" alt="Foto 1" loading="lazy">
            <div class="photo-overlay">💕 Moment 1</div>
          </div>
          <div class="photo-item" data-photo="images/foto2.jpg">
            <img src="https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=300&h=300&fit=crop" alt="Foto 2" loading="lazy">
            <div class="photo-overlay">✨ Moment 2</div>
          </div>
          <div class="photo-item" data-photo="images/foto3.jpg">
            <img src="https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&h=300&fit=crop" alt="Foto 3" loading="lazy">
            <div class="photo-overlay">🎈 Moment 3</div>
          </div>
          <div class="photo-item" data-photo="images/foto4.jpg">
            <img src="https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?w=300&h=300&fit=crop" alt="Foto 4" loading="lazy">
            <div class="photo-overlay">💖 Moment 4</div>
          </div>
        </div>
      </div>

      <!-- Message Container -->
      <div class="message-container" id="messageContainer">
        <div class="message">
          <div class="message-text" id="messageText"></div>
        </div>
      </div>

      <!-- Interactive Actions -->
      <div class="actions" id="actionsContainer">
        <div class="action-chip" data-action="wish">🌟 Doa Terbaik Untukmu</div>
        <div class="action-chip" data-action="love">💖 Pesan Cinta</div>
        <div class="action-chip" data-action="memory">📸 Kenangan Terindah</div>
        <div class="action-chip" data-action="future">🚀 Masa Depan Bersama</div>
      </div>

      <!-- Signature -->
      <div class="signature" id="signature">
        Dengan segenap cinta dan kasih sayang,<br>
        <strong>— Orang yang paling mencintaimu di dunia ini 💕</strong>
      </div>
    </div>
  </div>

  <!-- Photo Modal -->
  <div class="photo-modal" id="photoModal">
    <div class="photo-modal-close" id="photoModalClose">×</div>
    <img id="photoModalImg" src="" alt="Preview">
  </div>

  <!-- Audio Elements -->
  <audio id="bgMusic" loop preload="auto">
    <source src="music/birthday-song.mp3" type="audio/mpeg">
    <source src="music/birthday-song.ogg" type="audio/ogg">
  </audio>
  
  <audio id="clickSound" preload="auto">
    <source src="sounds/click.mp3" type="audio/mpeg">
  </audio>

  <audio id="successSound" preload="auto">
    <source src="sounds/success.mp3" type="audio/mpeg">
  </audio>

  <script>
    // =====================================================
    // KONFIGURASI MUDAH UNTUK EDIT
    // =====================================================
    const CONFIG = {
      targetName: "Ayu Cantik",
      birthdayDate: "16 Agustus 2025",
      messages: {
        main: [
          "🌟 Happy birthday, kamu adalah sinar matahari dalam hidupku!",
          "",
          "💖 Setiap hari bersamamu adalah hadiah yang tak ternilai.",
          "",
          "✨ Terima kasih sudah membuat hidupku begitu indah dan bermakna.",
          "",
          "🎂 Semoga tahun ini membawa kebahagiaan tak terbatas untukmu!",
          "",
          "💫 I love you more than words can express, today and always."
        ],
        wish: [
          "🌟 DoakuUntukmu:",
          "",
          "Semoga setiap langkahmu diberkahi,",
          "Semoga setiap impianmu menjadi kenyataan,",
          "Semoga kamu selalu dikelilingi cinta dan kebahagiaan,",
          "Dan semoga kita selalu bersama dalam suka dan duka.",
          "",
          "Aamiin ya Allah 🤲"
        ],
        love: [
          "💖 Pesan Cinta Dariku:",
          "",
          "Kamu adalah alasan aku tersenyum setiap pagi,",
          "Kamu adalah rumah dimana hatiku merasa aman,",
          "Kamu adalah mimpi terindah yang menjadi nyata,",
          "",
          "I love you beyond the stars and back 🌌",
          "",
          "Forever and always, you're my everything 💕"
        ],
        memory: [
          "📸 Kenangan Terindah Kita:",
          "",
          "Ingatkah saat pertama kita bertemu? ✨",
          "Tawa kita yang tidak pernah berhenti 😄",
          "Momen-momen sederhana yang begitu berharga 💝",
          "Setiap foto adalah cerita cinta kita 📷",
          "",
          "Terima kasih untuk semua memori indah ini 💕"
        ],
        future: [
          "🚀 Masa Depan Bersama:",
          "",
          "Aku ingin menghabiskan semua hari-hariku bersamamu,",
          "Membangun impian-impian baru bersama,",
          "Menjelajahi dunia dengan tangan bergandengan,",
          "Dan menciptakan lebih banyak kenangan indah,",
          "",
          "Selamanya, kamu dan aku 💍✨"
        ]
      },
      photos: [
        {
          src: "https://images.unsplash.com/photo-1517841905240-472988babdf9?w=300&h=300&fit=crop",
          alt: "Kenangan 1",
          caption: "Saat pertama kita bertemu 💕"
        },
        {
          src: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=300&h=300&fit=crop", 
          alt: "Kenangan 2",
          caption: "Tawa bahagia kita ✨"
        },
        {
          src: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=300&h=300&fit=crop",
          alt: "Kenangan 3", 
          caption: "Petualangan bersama 🎈"
        },
        {
          src: "https://images.unsplash.com/photo-1522075469751-3a6694fb2f61?w=300&h=300&fit=crop",
          alt: "Kenangan 4",
          caption: "Moment romantis kita 💖"
        }
      ]
    };

    // =====================================================
    // DOM ELEMENTS
    // =====================================================
    const elements = {
      loadingScreen: document.getElementById('loadingScreen'),
      mainCard: document.getElementById('mainCard'),
      mainEmoji: document.getElementById('mainEmoji'),
      targetName: document.getElementById('targetName'),
      birthdayDate: document.getElementById('birthdayDate'),
      openGiftBtn: document.getElementById('openGiftBtn'),
      photoGallery: document.getElementById('photoGallery'),
      messageContainer: document.getElementById('messageContainer'),
      messageText: document.getElementById('messageText'),
      actionsContainer: document.getElementById('actionsContainer'),
      signature: document.getElementById('signature'),
      photoModal: document.getElementById('photoModal'),
      photoModalImg: document.getElementById('photoModalImg'),
      photoModalClose: document.getElementById('photoModalClose'),
      particlesCanvas: document.getElementById('particles-canvas'),
      confettiCanvas: document.getElementById('confetti-canvas'),
      fireworksCanvas: document.getElementById('fireworks-canvas'),
      playMusicBtn: document.getElementById('playMusicBtn'),
      pauseMusicBtn: document.getElementById('pauseMusicBtn'),
      bgMusic: document.getElementById('bgMusic'),
      clickSound: document.getElementById('clickSound'),
      successSound: document.getElementById('successSound')
    };

    // =====================================================
    // PARTICLE SYSTEM
    // =====================================================
    class ParticleSystem {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.particles = [];
        this.resize();
        this.init();
        
        window.addEventListener('resize', () => this.resize());
      }

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      init() {
        for (let i = 0; i < 50; i++) {
          this.particles.push({
            x: Math.random() * this.canvas.width,
            y: Math.random() * this.canvas.height,
            size: Math.random() * 3 + 1,
            speedX: (Math.random() - 0.5) * 0.5,
            speedY: (Math.random() - 0.5) * 0.5,
            opacity: Math.random() * 0.5 + 0.2,
            hue: Math.random() * 60 + 300 // Purple to pink range
          });
        }
      }

      update() {
        this.particles.forEach(particle => {
          particle.x += particle.speedX;
          particle.y += particle.speedY;

          if (particle.x < 0 || particle.x > this.canvas.width) particle.speedX *= -1;
          if (particle.y < 0 || particle.y > this.canvas.height) particle.speedY *= -1;

          particle.opacity += (Math.random() - 0.5) * 0.02;
          particle.opacity = Math.max(0.1, Math.min(0.8, particle.opacity));
        });
      }

      draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        this.particles.forEach(particle => {
          this.ctx.beginPath();
          this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
          this.ctx.fillStyle = `hsla(${particle.hue}, 70%, 60%, ${particle.opacity})`;
          this.ctx.fill();
        });
      }

      animate() {
        this.update();
        this.draw();
        requestAnimationFrame(() => this.animate());
      }
    }

    // =====================================================
    // CONFETTI SYSTEM
    // =====================================================
    class ConfettiSystem {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.confetti = [];
        this.colors = ['#ff6b9d', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b', '#eb4d4b', '#6c5ce7'];
        this.resize();
        
        window.addEventListener('resize', () => this.resize());
      }

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      createConfetti(count = 100) {
        for (let i = 0; i < count; i++) {
          this.confetti.push({
            x: Math.random() * this.canvas.width,
            y: -10,
            size: Math.random() * 8 + 4,
            speedX: (Math.random() - 0.5) * 6,
            speedY: Math.random() * 3 + 3,
            rotation: Math.random() * Math.PI * 2,
            rotationSpeed: (Math.random() - 0.5) * 0.3,
            color: this.colors[Math.floor(Math.random() * this.colors.length)],
            gravity: 0.2,
            life: 1
          });
        }
      }

      update() {
        this.confetti.forEach((piece, index) => {
          piece.x += piece.speedX;
          piece.y += piece.speedY;
          piece.speedY += piece.gravity;
          piece.rotation += piece.rotationSpeed;
          piece.life -= 0.005;

          if (piece.y > this.canvas.height + 10 || piece.life <= 0) {
            this.confetti.splice(index, 1);
          }
        });
      }

      draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        this.confetti.forEach(piece => {
          this.ctx.save();
          this.ctx.translate(piece.x, piece.y);
          this.ctx.rotate(piece.rotation);
          this.ctx.globalAlpha = piece.life;
          this.ctx.fillStyle = piece.color;
          this.ctx.fillRect(-piece.size/2, -piece.size/2, piece.size, piece.size);
          this.ctx.restore();
        });
      }

      animate() {
        this.update();
        this.draw();
        if (this.confetti.length > 0) {
          requestAnimationFrame(() => this.animate());
        }
      }
    }

    // =====================================================
    // FIREWORKS SYSTEM
    // =====================================================
    class FireworksSystem {
      constructor(canvas) {
        this.canvas = canvas;
        this.ctx = canvas.getContext('2d');
        this.fireworks = [];
        this.particles = [];
        this.resize();
        
        window.addEventListener('resize', () => this.resize());
      }

      resize() {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
      }

      createFirework() {
        const colors = ['#ff6b9d', '#4ecdc4', '#45b7d1', '#f9ca24', '#f0932b'];
        const startX = Math.random() * this.canvas.width;
        const targetX = startX + (Math.random() - 0.5) * 200;
        const targetY = Math.random() * this.canvas.height * 0.5 + 50;

        this.fireworks.push({
          x: startX,
          y: this.canvas.height,
          targetX,
          targetY,
          speedX: (targetX - startX) * 0.03,
          speedY: (targetY - this.canvas.height) * 0.03,
          color: colors[Math.floor(Math.random() * colors.length)],
          exploded: false
        });
      }

      createParticles(x, y, color) {
        for (let i = 0; i < 30; i++) {
          const angle = (Math.PI * 2 * i) / 30;
          const speed = Math.random() * 6 + 2;
          
          this.particles.push({
            x,
            y,
            speedX: Math.cos(angle) * speed,
            speedY: Math.sin(angle) * speed,
            color,
            life: 1,
            decay: Math.random() * 0.02 + 0.01
          });
        }
      }

      update() {
        // Update fireworks
        this.fireworks.forEach((firework, fIndex) => {
          firework.x += firework.speedX;
          firework.y += firework.speedY;

          const distance = Math.sqrt(
            (firework.x - firework.targetX) ** 2 + 
            (firework.y - firework.targetY) ** 2
          );

          if (distance < 10 && !firework.exploded) {
            this.createParticles(firework.x, firework.y, firework.color);
            firework.exploded = true;
            this.fireworks.splice(fIndex, 1);
          }
        });

        // Update particles
        this.particles.forEach((particle, pIndex) => {
          particle.x += particle.speedX;
          particle.y += particle.speedY;
          particle.speedY += 0.1; // gravity
          particle.life -= particle.decay;

          if (particle.life <= 0) {
            this.particles.splice(pIndex, 1);
          }
        });
      }

      draw() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // Draw fireworks
        this.fireworks.forEach(firework => {
          this.ctx.beginPath();
          this.ctx.arc(firework.x, firework.y, 3, 0, Math.PI * 2);
          this.ctx.fillStyle = firework.color;
          this.ctx.fill();
        });

        // Draw particles
        this.particles.forEach(particle => {
          this.ctx.globalAlpha = particle.life;
          this.ctx.beginPath();
          this.ctx.arc(particle.x, particle.y, 2, 0, Math.PI * 2);
          this.ctx.fillStyle = particle.color;
          this.ctx.fill();
          this.ctx.globalAlpha = 1;
        });
      }

      animate() {
        this.update();
        this.draw();
        if (this.fireworks.length > 0 || this.particles.length > 0) {
          requestAnimationFrame(() => this.animate());
        }
      }

      startShow(duration = 5000) {
        const interval = setInterval(() => {
          this.createFirework();
        }, 300);

        setTimeout(() => {
          clearInterval(interval);
        }, duration);

        this.animate();
      }
    }

    // =====================================================
    // UTILITY FUNCTIONS
    // =====================================================
    function playSound(audioElement) {
      if (audioElement) {
        audioElement.currentTime = 0;
        audioElement.play().catch(e => console.log('Audio play failed:', e));
      }
    }

    function createSparkles(x, y, count = 12) {
      for (let i = 0; i < count; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = x + 'px';
        sparkle.style.top = y + 'px';
        
        const angle = (i * 360 / count) * Math.PI / 180;
        const distance = 30 + Math.random() * 20;
        const endX = x + Math.cos(angle) * distance;
        const endY = y + Math.sin(angle) * distance;
        
        document.body.appendChild(sparkle);
        
        sparkle.animate([
          { 
            transform: `translate(0, 0) scale(0)`, 
            opacity: 0 
          },
          { 
            transform: `translate(${endX - x}px, ${endY - y}px) scale(1)`, 
            opacity: 1,
            offset: 0.5 
          },
          { 
            transform: `translate(${endX - x}px, ${endY - y}px) scale(0)`, 
            opacity: 0 
          }
        ], {
          duration: 1000,
          easing: 'ease-out'
        }).onfinish = () => sparkle.remove();
      }
    }

    function hapticFeedback() {
      if (navigator.vibrate) {
        navigator.vibrate([100, 50, 100, 50, 200]);
      }
    }

    async function typeWriter(text, element, speed = 50) {
      element.innerHTML = '';
      const cursor = document.createElement('span');
      cursor.className = 'typing-cursor';
      
      let i = 0;
      return new Promise((resolve) => {
        function type() {
          if (i < text.length) {
            if (text[i] === '\n') {
              element.appendChild(document.createElement('br'));
            } else {
              element.appendChild(document.createTextNode(text[i]));
            }
            element.appendChild(cursor);
            i++;
            setTimeout(type, speed);
          } else {
            cursor.remove();
            resolve();
          }
        }
        type();
      });
    }

    // =====================================================
    // MAIN APPLICATION
    // =====================================================
    class BirthdayApp {
      constructor() {
        this.isGiftOpened = false;
        this.currentMessageType = 'main';
        this.init();
      }

      init() {
        // Setup configuration
        elements.targetName.textContent = CONFIG.targetName;
        elements.birthdayDate.textContent = CONFIG.birthdayDate;

        // Initialize systems
        this.particleSystem = new ParticleSystem(elements.particlesCanvas);
        this.confettiSystem = new ConfettiSystem(elements.confettiCanvas);
        this.fireworksSystem = new FireworksSystem(elements.fireworksCanvas);

        // Setup photos
        this.setupPhotos();

        // Setup event listeners
        this.setupEventListeners();

        // Start particle animation
        this.particleSystem.animate();

        // Hide loading screen and show card
        setTimeout(() => {
          elements.loadingScreen.classList.add('hidden');
          setTimeout(() => {
            elements.mainCard.classList.add('show');
          }, 500);
        }, 2000);
      }

      setupPhotos() {
        const photoGrid = elements.photoGallery.querySelector('.photo-grid');
        photoGrid.innerHTML = '';

        CONFIG.photos.forEach((photo, index) => {
          const photoItem = document.createElement('div');
          photoItem.className = 'photo-item';
          photoItem.innerHTML = `
            <img src="${photo.src}" alt="${photo.alt}" loading="lazy">
            <div class="photo-overlay">${photo.caption}</div>
          `;
          
          photoItem.addEventListener('click', () => {
            this.showPhotoModal(photo.src, photo.alt);
            playSound(elements.clickSound);
            hapticFeedback();
          });

          photoGrid.appendChild(photoItem);
        });
      }

      setupEventListeners() {
        // Open gift button
        elements.openGiftBtn.addEventListener('click', () => {
          this.openGift();
        });

        // Action chips
        document.querySelectorAll('.action-chip').forEach(chip => {
          chip.addEventListener('click', () => {
            const action = chip.dataset.action;
            this.showMessage(action);
            playSound(elements.clickSound);
            hapticFeedback();
          });
        });

        // Photo modal
        elements.photoModalClose.addEventListener('click', () => {
          this.hidePhotoModal();
        });

        elements.photoModal.addEventListener('click', (e) => {
          if (e.target === elements.photoModal) {
            this.hidePhotoModal();
          }
        });

        // Music controls
        elements.playMusicBtn.addEventListener('click', () => {
          this.playMusic();
        });

        elements.pauseMusicBtn.addEventListener('click', () => {
          this.pauseMusic();
        });

        // Emoji interaction
        elements.mainEmoji.addEventListener('click', () => {
          const rect = elements.mainEmoji.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          createSparkles(centerX, centerY, 15);
          playSound(elements.clickSound);
        });

        // Prevent zoom on double tap
        let lastTouchEnd = 0;
        document.addEventListener('touchend', (event) => {
          const now = Date.now();
          if (now - lastTouchEnd <= 300) {
            event.preventDefault();
          }
          lastTouchEnd = now;
        });
      }

      async openGift() {
        if (this.isGiftOpened) return;
        
        this.isGiftOpened = true;
        
        // Haptic feedback
        hapticFeedback();
        
        // Play success sound
        playSound(elements.successSound);
        
        // Button sparkles
        const btnRect = elements.openGiftBtn.getBoundingClientRect();
        const btnCenterX = btnRect.left + btnRect.width / 2;
        const btnCenterY = btnRect.top + btnRect.height / 2;
        createSparkles(btnCenterX, btnCenterY, 20);
        
        // Change emoji with animation
        elements.mainEmoji.style.transform = 'scale(1.3) rotateY(360deg)';
        setTimeout(() => {
          elements.mainEmoji.textContent = '🎉';
          elements.mainEmoji.style.transform = 'scale(1) rotateY(0deg)';
        }, 300);
        
        // Hide button
        elements.openGiftBtn.style.transform = 'scale(0) rotateY(180deg)';
        elements.openGiftBtn.style.opacity = '0';
        
        // Start celebrations
        setTimeout(() => {
          this.confettiSystem.createConfetti(150);
          this.confettiSystem.animate();
        }, 500);
        
        setTimeout(() => {
          this.fireworksSystem.startShow(4000);
        }, 1000);
        
        // Show photo gallery
        setTimeout(() => {
          elements.photoGallery.classList.add('show');
        }, 800);
        
        // Show message
        setTimeout(() => {
          this.showMessage('main');
        }, 1200);
        
        // Show actions
        setTimeout(() => {
          elements.actionsContainer.classList.add('show');
        }, 2500);
        
        // Show signature
        setTimeout(() => {
          elements.signature.classList.add('show');
        }, 3000);
        
        // Auto play music
        setTimeout(() => {
          this.playMusic();
        }, 1500);
      }

      async showMessage(type) {
        this.currentMessageType = type;
        const messages = CONFIG.messages[type];
        
        if (!messages) return;
        
        elements.messageContainer.classList.add('show');
        await typeWriter(messages.join('\n'), elements.messageText, 30);
      }

      showPhotoModal(src, alt) {
        elements.photoModalImg.src = src;
        elements.photoModalImg.alt = alt;
        elements.photoModal.classList.add('show');
        document.body.style.overflow = 'hidden';
      }

      hidePhotoModal() {
        elements.photoModal.classList.remove('show');
        document.body.style.overflow = '';
      }

      playMusic() {
        elements.bgMusic.play().then(() => {
          elements.playMusicBtn.style.display = 'none';
          elements.pauseMusicBtn.style.display = 'flex';
        }).catch(e => {
          console.log('Music play failed:', e);
        });
      }

      pauseMusic() {
        elements.bgMusic.pause();
        elements.playMusicBtn.style.display = 'flex';
        elements.pauseMusicBtn.style.display = 'none';
      }
    }

    // =====================================================
    // INITIALIZE APP
    // =====================================================
    document.addEventListener('DOMContentLoaded', () => {
      new BirthdayApp();
    });

    // =====================================================
    // PWA SERVICE WORKER (Optional)
    // =====================================================
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(() => console.log('SW registered'))
          .catch(() => console.log('SW registration failed'));
      });
    }
  </script>
</body>
</html>